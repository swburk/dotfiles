# Mutt {{{

set alias_file = ~/.mutt/aliases
set header_cache = ~/.mutt/cache/headers
set message_cachedir = ~/.mutt/cache/bodies
set mailcap_path = ~/.mutt/mailcap
set tmpdir = ~/.mutt/tmp

# }}}
# Folders {{{

# Root mail folder
set folder = ~/.mail

# Default inbox
set spoolfile = "=personal/INBOX"

# Archive folder
set mbox = "=personal/archive"

# Drafts folder
set postponed = "=personal/drafts"

# Sent folder
set record = =personal/sent

# Define mailboxes
mailboxes =personal/INBOX \
          =personal/archive \
          =personal/drafts \
          =personal/sent \
          =personal/junk \

set folder_format = "  %2C  %f"

# }}}
# General {{{

set mbox_type = Maildir # Default mailbox type when creating new folders
set wait_key = no # Don't prompt after running external programs
set timeout = 4 # Wait 4 seconds for user input
set beep_new # Beep when new messages come in
set delete = yes # Don't ask for confirmation when deleting messages
unset confirmappend # Don't ask for confirmation when moving messages
set uncollapse_jump # Jump to the first unread message in a thread
unset collapse_unread # Don't collapse a thread with an unread message
unset mark_old # Don't mark any messages as old
set pipe_decode # Weed headers before piping
unset help # Don't show help line at top of window
set menu_scroll # Scroll menus one line at a time
set sleep_time = 0 # Don't display informational messages
set sendmail_wait = 0 # Don't return to mutt until mail has been sent
unset resolve # Don't select the next message after a command
source ~/.vim/plugged/badwolf/contrib/badwolf.muttrc # Color scheme
# set attach_format = ""

# }}}
# Index {{{

set date_format = "%b %d"
set index_format = " %3C %?M?+& ? [%Z]  %D  %-20.20F  %s"
set sort = threads
set sort_aux = reverse-last-date-received
set strict_threads

# }}}
# Pager {{{

set pager_stop # Don't move to next message at end of current message
unset markers # Don't display "+" on wrapped lines in pager
set reflow_wrap = 0 # Wrap format=flowed messages to terminal width
set tilde # Display "~" on blank lines in pager
set pager_index_lines = 10 # Number of index lines to show
set pager_context = 4 # Number of context lines to show on next/prev page
auto_view text/html # Automatically display html emails
alternative_order text/plain text/enriched text/html
set pager_format = "-- Mutt: %-0.20F [%-0.46s] %* -- %P "

# }}}
# Composing and sending {{{

set realname = "Sam Burk"
set from = "sam@samburk.com"
set sendmail = "msmtp -a personal"
alternates swburk@fastmail\.fm swburk@wichita\.edu .+@samburk\.com .+@harmonicast\.net .+@smatteringpodcast\.com
set editor = "vim -c 'normal G'" # Use vim to compose emails
set abort_nosubject
set abort_unmodified
set text_flowed # Use format=flowed
# set edit_headers # Include headers when composing
# set autoedit # Skip prompts when composing new message
set fast_reply # Skip prompts when replying
set reply_to # Reply to address in Reply-to: header
set reverse_name # Reply with the address the email was sent to
set include # Include message when replying
set forward_edit = ask-no # Don't edit forwarded messages by default
set forward_decode # Decode attachments when forwarding
set forward_format = "Fwd: %s" # Format of subject when forwarding
# set attribution = "" # Don't include attribution header above quoted messages
set compose_format = "-- Mutt: Compose [%a Attachments]"

# }}}
# Contacts {{{

# set query_command = "lbdbq '%s'"
set query_command = "mu cfind --format=mutt-ab %s"
set query_format = "  %2c %t %-20.20n  %a"

# }}}
# Headers {{{

# What headers to display
ignore *
unignore from: to: cc: subject: date:

# What order to display the headers in
unhdr_order *
hdr_order from: to: cc: subject: date:

# }}}
# Status line {{{

set status_format = "-%r Mutt: %f [%?V?%M/&?%m Messages%?u?, %u Unread&?%?d?, %d Deleted&?%?F?, %F Flagged&?%?t?, %t Tagged&?%?p?, %p Postponed&?]%* %P "
set status_on_top # Show status line on top of winodw

# }}}
# Key bindings {{{

# Search in reverse
bind index,pager N search-opposite

# Run offlineimap
macro index o "<shell-escape>offlineimap -a personal<return>" "run offlineimap"
macro index O "<shell-escape>offlineimap -a personal -qf INBOX<return>" "run offlineimap on inbox"

# Full-text search with mu
macro index \\ "<shell-escape>mu find --clearlinks --format=links --linksdir=~/.mail/search " "mu find"
macro index \'r "<change-folder-readonly>~/.mail/search<return>" "mu find results"

# Toggle a message's "new" flag
bind index \# toggle-new
bind pager \# mark-as-new

# Archive message
macro index,pager a "<save-message>=personal/archive<return>" "save message to archive folder"

# Collapse/uncollapse threads
bind index <space> collapse-thread
bind index _ collapse-all

# Navigate folders
macro index,pager \'i "<change-folder>=personal/INBOX<return>" "open INBOX folder"
macro index,pager \'a "<change-folder>=personal/archive<return>" "open archive folder"
macro index,pager \'d "<change-folder>=personal/drafts<return>" "open drafts folder"
macro index,pager \'s "<change-folder>=personal/sent<return>" "open sent folder"
macro index,pager \'j "<change-folder>=personal/junk<return>" "open junk folder"

# Limits
macro index ,a "<limit>all<return>" "show all messages"
macro index ,n "<limit>~N<return>" "show all unread messages"
macro index ,t "<limit>~T<return>" "show all tagged messages"
macro index ,f "<limit>~F<return>" "show all flagged messages"

# Mark all messages as read
macro index \ca "<tag-pattern>~N<return><tag-prefix-cond><clear-flag>N<untag-pattern>~T<return>" "mark all messages as read"

# Sync mailbox
bind index,pager <tab> sync-mailbox

# Contacts completion
bind editor <Tab> complete-query
bind editor \ct complete

# Save a message to a folder
macro index,pager M "<save-message>?<toggle-mailboxes>" "move message to a folder"

# Add some of the index bindings to the pager
bind pager < previous-line
bind pager > next-line
bind pager = top
bind pager * bottom

# Always save attachments to downloads folder, and don't prompt me
macro attach s "<save-entry>~/Downloads/<return>y"

# }}}
# Hooks {{{

send-hook '~t ^.+@wichita\.edu$' 'my_hdr From: swburk@wichita.edu'

# }}}
